syntax = "proto3";

package confidence.flags.resolver.v1;

import "confidence/flags/resolver/v1/api.proto";
import "confidence/flags/resolver/v1/internal_api.proto";

option go_package = "github.com/spotify/confidence-resolver/openfeature-provider/go/confidence/internal/proto/wasm";
option java_package = "com.spotify.confidence.flags.resolver.v1";
option java_multiple_files = true;
option java_outer_classname = "WasmApiProto";

// Simplified from confidence-resolver/protos/confidence/flags/resolver/v1/wasm_api.proto
// Annotations removed for minimal dependencies

// Request for resolving flags with sticky (materialized) assignments
message ResolveWithStickyRequest {
  // The standard resolve request
  ResolveFlagsRequest resolve_request = 1;

  // if a materialization info is missing, we want tor return to the caller immediately
  bool fail_fast_on_sticky = 3;
  // if we should support sticky or completely skip the flag if they had sticky rules
  bool not_process_sticky = 4;

  // Context about the materialization required for the resolve
  repeated ReadResult materializations = 5;
}

// Response from resolving with sticky assignments
message ResolveWithStickyResponse {
  oneof resolve_result {
    Success success = 1;
    ReadOperationsRequest read_ops_request = 3;
  }
  
  // Successful resolution with materialization updates
  message Success {
    ResolveFlagsResponse response = 1;
    // New assignments that should be stored
    repeated VariantData materialization_updates = 3;
  }
}

message LogMessage {
  string message = 1;
}
